# Coturn TURN/STUN Server Configuration
# matrix-textvoicevideo — Self-Hosted Discord Alternative
#
# This file is auto-generated by setup.sh.
# Placeholder values below are replaced by setup.sh using sed.
#
# Placeholder → .env variable mapping:
#   domain_name      → SERVER_NAME
#   CHANGEME_CoTurn  → TURN_SECRET
#   PUBLIC_IP        → EXTERNAL_IP
#   UNRAID_IP        → INTERNAL_IP

# ===== REALM =====
realm=domain_name

# ===== AUTH (Matrix HMAC shared-secret) =====
# Do NOT add lt-cred-mech — it is incompatible with use-auth-secret
use-auth-secret
static-auth-secret=CHANGEME_CoTurn

# ===== NETWORK =====
listening-ip=UNRAID_IP
relay-ip=UNRAID_IP
external-ip=PUBLIC_IP/UNRAID_IP

listening-port=3478
tls-listening-port=5349

min-port=49160
max-port=49250

# ===== TLS =====
# Certs are mounted read-only from nginx/certs via docker-compose volume
cert=/certs/fullchain.pem
pkey=/certs/privkey.pem

# ===== SECURITY =====
fingerprint
no-cli
no-tlsv1
no-tlsv1_1

# Block relay to all private/loopback IP ranges (prevents SSRF attacks)
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=100.64.0.0-100.127.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=240.0.0.0-255.255.255.255
# Allow relay to our own Unraid LAN IP
allowed-peer-ip=UNRAID_IP

# ===== PERFORMANCE (~50 concurrent TURN sessions) =====
total-quota=300
stale-nonce=600
max-bps=3000000

# ===== LOGGING =====
log-file=stdout
verbose
